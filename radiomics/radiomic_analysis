import os
from radiomics import featureextractor

"""
A new conda environment has been made to accommodate radiomics' need for python 3.7.12. Remember to use this interpreter in VS CODE
"""

datapath = "D:\\GBM\\summary\\AUH"
extractor = featureextractor.RadiomicsFeatureExtractor("radiomics\Params.yaml")

def extract_features(patient_number):
    # Find relevant files
    for file_name in os.listdir(os.join(datapath, patient_number)):
        if file_name.statswith("time0") and file_name.endswith("gtv.nii"):
            label_path = file_name
        elif file_name.startswith("time0") and file_name.endswith("MR.nii"):
            image_path = file_name

    # Feature extraction
    print("Calculating features for:", patient_number)
    result = extractor.execute(image_path, label_path)
    print("Done!")

    features = {}
    # Grab useful metrics
    for key, value in result.items():
        if not key.startswith("diagnostics"): # Do not include diagnostic info
            features[key] = value
    
    return features

patient_features = {}
for patient_number in os.listdir(datapath): 
    patient_features[patient_number] = extract_features(patient_number)

do_print = False

#for key,value in features.items():
#    print((key + " ").ljust(40, "-"), ":", value)